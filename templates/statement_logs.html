<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Danh s√°ch S·ªï ph·ª•</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-success">
    <div class="container-fluid">
        <a class="navbar-brand" href="#">User Panel</a>
        <div class="collapse navbar-collapse">
            <ul class="navbar-nav me-auto">
                <li class="nav-item"><a class="nav-link" href="{{ url_for('main.user_dashboard') }}">Trang ch·ªß</a></li>
            </ul>
            <span class="navbar-text text-white">Xin ch√†o, {{ username }}</span>
        </div>
    </div>
</nav>

<div class="container mt-4">
    <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0">üìö Danh s√°ch S·ªï ph·ª•</h5>
            <a href="{{ url_for('main.user_dashboard') }}" class="btn btn-sm btn-secondary">Quay l·∫°i</a>
        </div>
        <div class="card-body">
            <form class="row g-2 mb-3" aria-label="Filter statement logs">
                <div class="col-auto">
                    <label for="filter-bank" class="visually-hidden">Ng√¢n h√†ng</label>
                    <select id="filter-bank" name="bank_code" class="form-select" title="Ch·ªçn ng√¢n h√†ng ƒë·ªÉ l·ªçc">
                        <option value="">T·∫•t c·∫£ ng√¢n h√†ng</option>
                        {% for b in banks %}
                        <option value="{{ b }}">{{ b }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-auto">
                    <label for="filter-status" class="visually-hidden">Tr·∫°ng th√°i</label>
                    <select id="filter-status" name="status" class="form-select" title="Ch·ªçn tr·∫°ng th√°i">
                        <option value="">T·∫•t c·∫£ tr·∫°ng th√°i</option>
                        <option value="SUCCESS">SUCCESS</option>
                        <option value="FAILED">FAILED</option>
                        <option value="UNKNOWN">UNKNOWN</option>
                    </select>
                </div>
                <div class="col-auto">
                    <label for="filter-from" class="visually-hidden">T·ª´ ng√†y</label>
                    <input id="filter-from" type="date" name="from" class="form-control" title="T·ª´ ng√†y (YYYY-MM-DD)" placeholder="From" />
                </div>
                <div class="col-auto">
                    <label for="filter-to" class="visually-hidden">ƒê·∫øn ng√†y</label>
                    <input id="filter-to" type="date" name="to" class="form-control" title="ƒê·∫øn ng√†y (YYYY-MM-DD)" placeholder="To" />
                </div>
                <div class="col-auto">
                    <button type="submit" class="btn btn-primary">L·ªçc</button>
                </div>
            </form>

            {% if logs %}
            <div class="table-responsive">
                <table class="table table-sm table-hover">
                    <thead class="table-light">
                        <tr>
                            <th>ID</th>
                            <th>File</th>
                            <th>Ng√¢n h√†ng</th>
                            <th>S·ªë t√†i kho·∫£n</th>
                            <th>Tr·∫°ng th√°i</th>
                            <th>Th·ªùi gian</th>
                            <th>H√†nh ƒë·ªông</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for l in logs %}
                        <tr>
                            <td>{{ l.id }}</td>
                            <td>{{ l.original_filename or '-' }}</td>
                            <td>{{ l.bank_code or '-' }}</td>
                            <td>{{ l.accountno or '-' }}</td>
                            <td>{{ l.status }}</td>
                            <td>{{ l.processed_at.strftime('%d/%m/%Y %H:%M') if l.processed_at else '-' }}</td>
                            <td>
                                <a href="{{ url_for('main.view_statement_detail', log_id=l.id) }}" class="btn btn-sm btn-outline-secondary">Chi ti·∫øt</a>
                                {% if l.mt940_filename %}
                                <a href="{{ url_for('main.download_statement_mt940', log_id=l.id) }}" class="btn btn-sm btn-outline-primary">T·∫£i MT940</a>
                                <a href="{{ url_for('main.delete_statement_log', log_id=l.id) }}" class="btn btn-sm btn-danger" onclick="return confirm('X√≥a b·∫£n ghi s·ªï ph·ª• n√†y?')">X√≥a</a>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {# Pagination controls #}
            {% if pagination and pagination.total_pages > 1 %}
            <nav aria-label="Page navigation" class="mt-3">
                <ul class="pagination">
                    <li class="page-item {% if not pagination.has_prev %}disabled{% endif %}">
                        <a class="page-link" href="{{ url_for('main.list_statement_logs', page=pagination.page-1, bank_code=request.args.get('bank_code'), status=request.args.get('status'), from=request.args.get('from'), to=request.args.get('to'), per_page=pagination.per_page) }}" aria-label="Previous">&laquo;</a>
                    </li>

                    {# show a small window of pages around current #}
                    {% set start_page = pagination.page - 2 if pagination.page - 2 > 1 else 1 %}
                    {% set end_page = pagination.page + 2 if pagination.page + 2 < pagination.total_pages else pagination.total_pages %}
                    {% for p in range(start_page, end_page + 1) %}
                    <li class="page-item {% if p == pagination.page %}active{% endif %}">
                        <a class="page-link" href="{{ url_for('main.list_statement_logs', page=p, bank_code=request.args.get('bank_code'), status=request.args.get('status'), from=request.args.get('from'), to=request.args.get('to'), per_page=pagination.per_page) }}">{{ p }}</a>
                    </li>
                    {% endfor %}

                    <li class="page-item {% if not pagination.has_next %}disabled{% endif %}">
                        <a class="page-link" href="{{ url_for('main.list_statement_logs', page=pagination.page+1, bank_code=request.args.get('bank_code'), status=request.args.get('status'), from=request.args.get('from'), to=request.args.get('to'), per_page=pagination.per_page) }}" aria-label="Next">&raquo;</a>
                    </li>
                </ul>
            </nav>
            {% endif %}
            {% else %}
            <p class="text-muted">Kh√¥ng c√≥ b·∫£n ghi.</p>
            {% endif %}
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
